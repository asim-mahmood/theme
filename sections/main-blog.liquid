<section class="max-w-5xl mx-auto px-6 py-12">

  <!-- Page Title -->
  <h1 class="text-4xl font-bold mb-2">
    {{ section.settings.custom_title | default: blog.title }}
  </h1>

  <!-- Tag Filter -->
  {% if section.settings.enable_tags and blog.all_tags.size > 0 %}
    <div class="flex flex-wrap gap-3 mb-8">
      {% for tag in blog.all_tags %}
        <a href="{{ blog.url }}/tagged/{{ tag | handle }}"
           class="px-4 py-2 border rounded-full text-sm hover:bg-gray-200 transition">
          {{ tag }}
        </a>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Search -->
  {% if section.settings.enable_search %}
    <form method="get" action="{{ blog.url }}" class="mb-8">
      <input 
        type="text" 
        name="q" 
        value="{{ search.terms | escape }}"
        placeholder="Search articles..."
        class="w-full border px-4 py-3 rounded-lg"
      >
    </form>
  {% endif %}

  {% if blog.articles_count == 0 %}
    <p>No posts found.</p>

  {% else %}
    <div class="grid gap-10 md:grid-cols-{{ section.settings.columns }}">

      {% for article in blog.articles limit: section.settings.article_limit %}
        <article class="border rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition">

          {% if article.image %}
            <a href="{{ article.url }}">
              <img 
                src="{{ article.image | image_url: width: section.settings.image_width }}"
                width="{{ section.settings.image_width }}"
                height="{{ section.settings.image_width | divided_by: 1.5 }}" 
                loading="lazy"
                class="w-full h-auto object-cover"
                alt="{{ article.title }}"
              >
            </a>
          {% endif %}

          <div class="p-6">
            <h2 class="text-2xl font-semibold mb-2">
              <a href="{{ article.url }}" class="hover:text-blue-600 transition">
                {{ article.title }}
              </a>
            </h2>

            <p class="text-gray-500 text-sm mb-3">
              {{ article.published_at | date: "%B %d, %Y" }}
            </p>

            <p class="text-gray-700 mb-4">
              {{ article.excerpt | strip_html | truncate: section.settings.excerpt_length }}
            </p>

            <a 
              href="{{ article.url }}" 
              class="inline-block text-blue-600 underline hover:text-blue-800 transition"
            >
              {{ section.settings.read_more_text }}
            </a>
          </div>

        </article>
      {% endfor %}

    </div>
  {% endif %}
</section>

{% schema %}
{
  "name": "Main Blog Section",
  "settings": [
    {
      "type": "blog",
      "id": "blog_picker",
      "label": "Select blog"
    },
    {
      "type": "checkbox",
      "id": "enable_tags",
      "label": "Show tag filters",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "label": "Enable search",
      "default": false
    },
    {
      "type": "range",
      "id": "article_limit",
      "min": 1,
      "max": 20,
      "step": 1,
      "default": 6,
      "label": "Number of articles"
    },
    {
      "type": "select",
      "id": "columns",
      "label": "Grid columns",
      "default": "2",
      "options": [
        { "value": "1", "label": "1 column" },
        { "value": "2", "label": "2 columns" },
        { "value": "3", "label": "3 columns" }
      ]
    },
    {
      "type": "range",
      "id": "excerpt_length",
      "min": 50,
      "max": 300,
      "step": 10,
      "default": 150,
      "label": "Excerpt length (characters)"
    },
    {
      "type": "range",
      "id": "image_width",
      "min": 300,
      "max": 2000,
      "step": 100,
      "default": 800,
      "label": "Image width"
    },
    {
      "type": "text",
      "id": "read_more_text",
      "label": "Read more text",
      "default": "Read more â†’"
    }
  ],
  "presets": [
    {
      "name": "Main Blog"
    }
  ]
}
{% endschema %}
